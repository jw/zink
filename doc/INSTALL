
INSTALL

The required packages
=====================

These need to be installed first, using apt-get and via hg, so best to
ensure mercurial is installed too:

- mercurial: sudo apt-get install mercurial
- pip: sudo apt-get install python-pip
- python-dev (needed for the psql driver): sudo apt-get install python3-dev
- postgresql: sudo apt-get install postgresql-server-dev-9.3 postgresql
- nginx: sudo apt-get install nginx

Note:
Install the uwsgi from source.  See below.

The pip install -r requirements will install the other packages/libraries

The database
============

The database can be created using the fabric script (see below), but you
can also create the database yourself.  Best to use the properties you
need to specify in the fabfile.properties file.

0) sudo -u postgres psql

1) Make sure you own the database engine
postgres=# ALTER USER postgres WITH PASSWORD '<your password>';

2) Create a database user
postgres=# create role <db.username> with createdb login
postgres-# password '<db.password>';

3) Create a database owned by this user
postgres=# create database <db.name> owner <db.username>;

The webserver
=============

nginx
~~~~~

Plain deb install: sudo apt-get install uwsgi

uwsgi
~~~~~

Install uwsgi from source in a separate directory:

> wget http://projects.unbit.it/downloads/uwsgi-2.0.7.tar.gz

Get python 2 and 3 development files

> sudo apt-get install python-dev python3-dev

Then build the modular uWGSI system:

> python uwsgiconfig.py --build core
> python2.7 uwsgiconfig.py --plugin plugins/python core python27
> python3.4 uwsgiconfig.py --plugin plugins/python core python34

Done!

Run the instance
================

The Django instance can run using the webserver (nginx and uwsgi) or
via the regular runserver manage.py task.

But remeber that a superuser needs to be added:
> python manage createsuperuser

Fabric
======

fabfile.properties
~~~~~~~~~~~~~~~~~~

Fabric uses the fabfile.properties file to get the authentication data
(password, username) for three building environments:

 - development: your machine
 - staging: staging.elevenbits.org
 - production: www.elevenbits.org

zink.properties
~~~~~~~~~~~~~~~

It also uses the zink.properties file which needs to contain these entries:

[project]
key: <the key of the project, used by Django to secure your application>

[email]
host: <your email host>
port: <your email port>
user: <your email user>
password: <your email password>
tls: <set True to use tls (secure) mailing, False otherwise>

[twitter]
name: <your twitter name>
consumer.key: <your consumer key>
consumer.secret: <your consumer secret>
oauth.token: <your oauth token>
oauth.token.secret: <your oauth token secret>

settings.py
~~~~~~~~~~~

Using these two files, the Fabric will create a local settings file which
will become part of settings.py.

Database creation
~~~~~~~~~~~~~~~~~

Using the local settings file (containing all the database authentication
rules), Fabric will make sure that the database user and database are
present.  If they are not, they are created and the database is populated
with some default data.  When the user and the database are available,
no population is done during the deploy step.

It is of course possible to populate the database using the populate task.

Fixtures
========

To create fixtures:

python manage.py dumpdata --indent 4 treemenus > /home/jw/treemenus.json
python manage.py dumpdata --indent 4 blog > /home/jw/blog.json
python manage.py dumpdata --indent 4 static > /home/jw/static.json

To populate the database with them:
TODO
